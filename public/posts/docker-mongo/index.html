<!doctype html><html class="h-full w-full font-sans" lang=en-us><head>
<meta charset=utf-8>
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Creating a MongoDB instance with a web interface in Docker - MIOI Blog</title>
<meta name=description content="test">
<meta name=author content="Tom van Dinther">
<meta property="og:title" content="Creating a MongoDB instance with a web interface in Docker">
<meta property="og:description" content="test">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/docker-mongo/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-02T12:59:47+12:00">
<meta property="article:modified_time" content="2021-09-02T12:59:47+12:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Creating a MongoDB instance with a web interface in Docker">
<meta name=twitter:description content="test">
<link rel=stylesheet href=/css/styles.min.65f96a71f6d3a938a442d244f995e837771890d4cd40a732f23af84decbfe566f27b11bb5a5b1fcb396694aaafdcce9b640be6a1959f0964bcad4661181acfd6.css integrity=sha512-ZflqcfbTqTikQtJE+ZXoN3cYkNTNQKcy8jr4Tey/5WbyexG7WlsfyzlmlKqv3M6bZAvmoZWfCWS8rUZhGBrP1g==>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-8PPBKZ5GD1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script>localStorage.theme==='dark'||!('theme'in localStorage)&&window.matchMedia('(prefers-color-scheme: dark)').matches?document.documentElement.classList.add('dark'):document.documentElement.classList.remove('dark')</script>
</head><body class="flex flex-col items-center w-full">
<main class="w-full sm:w-10/12 md:w-9/12 lg:w-7/12 xl:w-5/12 m-auto px-6"><header class="mt-9 mb-8">
<div class="flex justify-between items-center">
<div class="flex items-center">
<input id=navbar_btn class=hidden type=checkbox>
<label for=navbar_btn class="menu-btn mr-4 items-center flex xl:hidden">
<span class=navicon></span>
</label>
<a href=/ class="font-bold text-lg xl:text-2xl mr-auto">MIOI Blog</a>
</div>
<div class="flex items-center">
<div class="cursor-pointer ml-2">
<svg id="dark_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 15.31 23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg></svg>
<svg id="light_mode_btn" class="hidden" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g><path d="M0 0h24v24H0V0z" fill="none"/></g><g><g><g><path d="M14 2c1.82.0 3.53.5 5 1.35C16.01 5.08 14 8.3 14 12s2.01 6.92 5 8.65C17.53 21.5 15.82 22 14 22 8.48 22 4 17.52 4 12S8.48 2 14 2z"/></g></g></g></svg></svg>
</div>
</div>
</div>
<nav id=navbar class="mt-3 hidden xl:block"><ul class=flex><li class="navbar-item text-sm border-b-2 pb-1 mr-2 font-medium insection">
<a href=/posts/>Posts</a>
</li></ul>
</nav>
<nav id=navbar_sm class="mt-2 hidden">
<ul>
<li class="text-sm mt-2">
<a href=/posts/>Posts</a></li>
</ul>
<hr class=my-4>
</nav>
</header>
<div id=content class=my-8>
<div class="collapsible-menu-wrapper my-8 p-4 border-2 rounded">
<input id=collapse_btn_toc class="hidden collapse-btn-input" type=checkbox>
<div class="flex justify-between">
<span class=font-bold>Table of contents</span>
<label for=collapse_btn_toc class=collapse-btn><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10 17l5-5-5-5v10z"/><path d="M0 24V0h24v24H0z" fill="none"/></svg></label>
</div>
<div class="collapsible-menu text-sm ml-2">
<div class=leading-6>
<nav id=TableOfContents>
<ul>
<li><a href=#mongodb>MongoDB</a></li>
<li><a href=#mongo-express>Mongo Express</a>
<ul>
<li></li>
</ul>
</li>
<li><a href=#populate-the-database>Populate the database</a>
<ul>
<li><a href=#using-mongo-express>Using Mongo Express</a></li>
<li><a href=#using-mongo-shell-script>Using Mongo shell script</a></li>
</ul>
</li>
<li><a href=#conclusion>Conclusion</a></li>
<li><a href=#related-posts>Related Posts</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div class=my-7>
<article>
<p>When building a full-stack application with MongoDB as your database, it can often be difficult to start out. Installing all of the right pieces on your machine for the first time can be difficult and perhaps a Google search for this is the very thing that brought you here. You may also be somewhat familiar with Docker, and so you&rsquo;d like to try build your full-stack along with Docker to ease your development experience. Because Docker is such a wonderful tool, it can make our task easy and automated. Everything we are going to set up here can be pushed to your project&rsquo;s remote git repository and be brought to life on another computer with a single command. Now that&rsquo;s a great developer experience.</p>
<h2 id=mongodb>MongoDB</h2>
<p>We are going to set up our environment using the <code>docker-compose</code> command-line tool. With <code>docker-compose</code> we are able to define our services in a configuration file and run the command-line tool against it to bring our environment to life.</p>
<p>To start off our configuration, we will create a file named <code>docker-compose.yml</code> at the top level of our project directory and start off with the following 2 lines:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.9&#34;</span>
<span style=color:#f92672>services</span>:
	
</code></pre></td></tr></table>
</div>
</div><p><code>version: "3.9"</code> tells the command-line tool which version of the API to use when parsing this configuration. As of writing, 3.9 is the latest version.
<code>services</code> is the top-level property which will contain the definitions for all of the services we would like in our environment.</p>
<p>The first service we will create is the database itself.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.9&#34;</span>
<span style=color:#f92672>services</span>:

  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Here we are defining a service named <code>mongodb</code> and specifying the image to be used as <code>mongo:bionic</code>. <code>bionic</code> is a version tag of the image. It is always a good idea to pin your images to a tag to ensure predictability in a configuration. Sometimes, the way in which images are configured changes, environment variables get deprecated and configuration file structures altered. By pinning the version we can ensure that we can start our environment the same as when we created it years into the future.</p>
<p><code>ports:</code> is used to connect a port from the host machine to the container. The shorthand syntax used here is <code>&lt;host port>:&lt;container port></code>. In this case, we are connecting port 27017 on our host machine to port 27017 of the container.</p>
<p>Running this configuration now would create a container running an instance of MongoDB accessible from <code>localhost:27017</code>. We can do this by running the following command:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose up
</code></pre></td></tr></table>
</div>
</div><p>The command automatically looks for a file in the current working directory named <code>docker-compose.yml</code> to receive its instructions.</p>
<p>When you are ready to stop and remove the containers you can do this with:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose down
</code></pre></td></tr></table>
</div>
</div><p>Something important to note about our configuration is that in this state, the instance of MongoDB will start without authentication enabled. This isn&rsquo;t analogous of a production environment, and our applications that use the database will be relying on making an authenticated connection. To do this we need to add a few more lines to our <code>docker-compose.yml</code> file.</p>
<p>On the Docker Hub page for the <a href=https://hub.docker.com/_/mongo>mongo</a> image we are given some information on how to use it. The entrypoint script of this image looks for the two environment variables <code>MONGO_INITDB_ROOT_USERNAME</code> and <code>MONGO_INITDB_ROOT_PASSWORD</code> to create a root user account in the database. We can supply these by using <code>environment:</code> in the yaml file as follows:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.9&#34;</span>
<span style=color:#f92672>services</span>:

  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>mongo</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>MONGO_INITDB_ROOT_USERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>MONGO_INITDB_ROOT_PASSWORD</span>: <span style=color:#ae81ff>test1234</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Running this configuration now would create an authenticated instance of MongoDB. However, conveniently connecting to and managing the database in this state requires some tools. Perhaps we can download a tool like <a href=https://www.mongodb.com/products/compass>MongoDB Compass</a>, or we could use a web interface like <em>Mongo Express</em>.</p>
<h2 id=mongo-express>Mongo Express</h2>
<p><em>Mongo Express</em> is a web client for MongoDB written in Node.js using the express framework. It contains functionality for us to be able to perform CRUD operations on the database as well as some monitoring and administrative tasks. What&rsquo;s better yet, is we can spin one of these up within our <code>docker-compose</code> configuration.</p>
<p>To do this, we define a new service just like before. Create a new line underneath the <code>mongodb</code> service and define the following:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>mongo-express</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo-express</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>ME_CONFIG_MONGODB_SERVER</span>: <span style=color:#ae81ff>mongodb</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINUSERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINPASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_USERNAME</span>: <span style=color:#ae81ff>admin</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_PASSWORD</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;8081:8081&#34;</span>
    <span style=color:#f92672>depends_on</span>:
      - <span style=color:#ae81ff>mongodb</span>
</code></pre></td></tr></table>
</div>
</div><p>The Docker Hub page on the <a href=https://hub.docker.com/_/mongo-express>mongo-express</a> image gives us some details on how to use it. Specifically, we are interested in the port the web server listens on and the environment variables used for configuration. We can see that the port we need to map is port 8081, which we&rsquo;ve mapped to our host port 8081.</p>
<p>We then need to tell mongo-express how to connect to our database. For this we use the <code>ME_CONFIG_MONGODB_</code> environment variables where <code>SERVER</code> is the hostname of the container the MongoDB instance is running on and <code>ADMINUSERNAME</code> and <code>ADMINPASSWORD</code> are the credentials to an account with admin level access across the database. For this we can use the credentials of the root account we defined earlier. Lastly, the <code>ME_CONFIG_BASICAUTH_</code> environment variables define the credentials we can use to log in to the web interface.</p>
<p><code>depend_on:</code> does what you&rsquo;d expect; it waits for the containers it depends on to start before starting itself. This is important because the <code>mongo-express</code> container will exit if it fails to establish a connection to the instance of MongoDB. Doing this will ensure that it starts correctly <em>almost</em> consistently. Why only <em>almost</em>? Docker will wait until the listed containers start successfully but it does not know if the software inside of the containers have finished initialising and opened sockets on their ports yet. This creates a race condition and may require a manual restart of the <code>mongo-express</code> container if it wins the race.</p>
<p>In a docker-compose environment, the hostname of a service is automatically given by the name of the service. A hostname can also be manually provided by using the <code>hostname:</code> property. This behaviour is true for the user-defined <em>bridge</em> network mode. So for DNS resolution to occur, and for our <code>mongodb</code> service to be found by <code>mongo-express</code> we must define our own network and assign it to our services.</p>
<h6 id=refer-to-the-documentation-on-dockercomhttpsdocsdockercomnetworkbridge-for-more-details>Refer to the documentation on <a href=https://docs.docker.com/network/bridge/>docker.com</a> for more details.</h6>
<p>At the bottom of our <code>docker-compose.yml</code> add a new top-level property and sub property as follows:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>networks</span>:
  <span style=color:#f92672>internal-network</span>:
    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span> <span style=color:#75715e># default, can be omitted</span>
</code></pre></td></tr></table>
</div>
</div><p>To assign this network to our services add it to each service configuration:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>mongo</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>MONGO_INITDB_ROOT_USERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>MONGO_INITDB_ROOT_PASSWORD</span>: <span style=color:#ae81ff>test1234</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>

  <span style=color:#f92672>mongo-express</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo-express</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>ME_CONFIG_MONGODB_SERVER</span>: <span style=color:#ae81ff>mongodb</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINUSERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINPASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_USERNAME</span>: <span style=color:#ae81ff>admin</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_PASSWORD</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;8081:8081&#34;</span>
    <span style=color:#f92672>depends_on</span>:
      - <span style=color:#ae81ff>mongodb</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>
</code></pre></td></tr></table>
</div>
</div><p>Running this configuration now would create an authenticated instance of MongoDB accessible from <code>localhost:27017</code> and a web interface accessible from <code>localhost:8081</code>.</p>
<h2 id=populate-the-database>Populate the database</h2>
<p>Now we have a MongoDB instance running and an interface to access it with ease, we may want to add some data for our consuming application to fetch. One option is to manually add the data through Mongo Express. It contains options to import batch data through csv. Another option is to insert data using scripted Mongo shell. We will go through the configuration to allow both options as they each uncover new details about our docker-compose configuration.</p>
<h3 id=using-mongo-express>Using Mongo Express</h3>
<p>I won&rsquo;t go through the details of actually importing data via csv, as the interface can guide you through that process. However, when you run <code>docker-compose down</code> the database container is removed and with it, all of the imported data! You don&rsquo;t want to go through this process every time a container is created so one way in which we can persist the data is by mounting an external volume onto the directory inside the container which contains the data. This way when the container is created, we can use our host&rsquo;s directory to serve up the data. Note that this method of populating the database is not preserved through git.</p>
<p>We will create a volume bind whereby a host directory is mounted onto a container directory. This is simply done by modifying the <code>docker-compose.yml</code> file accordingly:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>mongo</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>MONGO_INITDB_ROOT_USERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>MONGO_INITDB_ROOT_PASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>MONGO_INITDB_DATABASE</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./db-data:/data/db</span>
</code></pre></td></tr></table>
</div>
</div><p>The <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#volumes>documentation</a> describes several ways in defining a volume. Some ways may be more suitable for your needs than others. In this example we are using a directory relative to the <code>docker-compose.yml</code> file named <code>db-data</code> to serve as the source for the containers <code>/data/db</code> directory.</p>
<h3 id=using-mongo-shell-script>Using Mongo shell script</h3>
<p>An alternative method to populating the database is by seeding it on initialistion through the use of initialisation scripts. These have the upside of being preserved through git but have the downside (possibly an upside for testability) that any data inserted after initialisation is lost when the container is rebuilt.</p>
<p>To do this, the first thing we must do is create our script. Mongo shell script uses javascript and so to begin we will create a file named <code>init-data.js</code> inside of a new directory named <code>mongo</code> to contain our mongo specific artifacts. The first line in our script will be an instruction to authenticate as the root user which must be done against the <code>admin</code> database. Then we will change our context to our application database which we will name <code>mydatabase</code>.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>auth</span>(<span style=color:#ae81ff>_</span><span style=color:#a6e22e>getEnv</span>(<span style=color:#e6db74>&#34;MONGO_INITDB_ROOT_USERNAME&#34;</span>), <span style=color:#ae81ff>_</span><span style=color:#a6e22e>getEnv</span>(<span style=color:#e6db74>&#34;MONGO_INITDB_ROOT_PASSWORD&#34;</span>))

<span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>getSiblingDB</span>(<span style=color:#e6db74>&#39;mydatabase&#39;</span>)
</code></pre></td></tr></table>
</div>
</div><p>The script starts with a global <code>db</code> object pre-defined as the initial database. Which database is set as the initial database for our initialisation scripts is set by an environment variable which we will set up shortly. We authenticate using the <code>auth()</code> method of the <code>db</code> object and pass in the username and password from the environment variables using the built-in function <code>_getEnv()</code>. We then change our <code>db</code>object to a new database object named <code>mydatabase</code>.</p>
<p>From here we can insert any data we wish by using the pattern <code>db.&lt;collection name>.insert(&lt;object>)</code>. For example:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>blogPosts</span>.<span style=color:#a6e22e>insert</span>({
	<span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Creating a MongoDB instance in Docker with a web interface&#34;</span>,
	<span style=color:#a6e22e>author</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Tom van Dinther&#34;</span>,
	<span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ISODate</span>(<span style=color:#e6db74>&#34;2021-08-30T16:00:00.000Z&#34;</span>)
})
</code></pre></td></tr></table>
</div>
</div><p>Once you have defined the seed data you&rsquo;d like to populate the database with, we need to give the container access to it in a directory where the entrypoint script looks for it. As given by the image <a href=https://hub.docker.com/_/mongo>documentation</a> this location is <code>/docker-entrypoint-initdb.d/</code>. To do this, we define a bind volume of our project&rsquo;s <code>mongo</code> directory as follows:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>mongo</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>MONGO_INITDB_ROOT_USERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>MONGO_INITDB_ROOT_PASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>MONGO_INITDB_DATABASE</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./mongo:/docker-entrypoint-initdb.d/</span>
</code></pre></td></tr></table>
</div>
</div><p>In this step we have also defined the initial database that our scripts will be given via the global <code>db</code> object using the <code>MONGO_INITDB_DATABASE</code> environment variable. We have specified this to be <code>admin</code> so that the script can authenticate as a root user which is stored in this database.</p>
<h2 id=conclusion>Conclusion</h2>
<p>Congratulations, you should now have an instance of MongoDB running inside of a container using Docker and a web interface with admin access. This isn&rsquo;t the end of configuring MongoDB inside of Docker, so be sure to come back and find links to the other parts in this post when they come available. Take a look below at our fInal <code>docker-compose.yml</code> file:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.9&#34;</span>
<span style=color:#f92672>services</span>:

  <span style=color:#f92672>mongodb</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo:bionic</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>MONGO_INITDB_ROOT_USERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>MONGO_INITDB_ROOT_PASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>MONGO_INITDB_DATABASE</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;27017:27017&#34;</span>
    <span style=color:#f92672>volumes</span>:
<span style=color:#75715e>#      - ./db-data:/data/db</span>
      - <span style=color:#ae81ff>./mongo:/docker-entrypoint-initdb.d/</span>

  <span style=color:#f92672>mongo-express</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mongo-express</span>
    <span style=color:#f92672>environment</span>:
      <span style=color:#f92672>ME_CONFIG_MONGODB_SERVER</span>: <span style=color:#ae81ff>mongodb</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINUSERNAME</span>: <span style=color:#ae81ff>root</span>
      <span style=color:#f92672>ME_CONFIG_MONGODB_ADMINPASSWORD</span>: <span style=color:#ae81ff>test1234</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_USERNAME</span>: <span style=color:#ae81ff>admin</span>
      <span style=color:#f92672>ME_CONFIG_BASICAUTH_PASSWORD</span>: <span style=color:#ae81ff>admin</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#e6db74>&#34;8081:8081&#34;</span>
    <span style=color:#f92672>networks</span>:
      - <span style=color:#ae81ff>internal-network</span>
    <span style=color:#f92672>depends_on</span>:
      - <span style=color:#ae81ff>mongodb</span>

<span style=color:#f92672>networks</span>:
  <span style=color:#f92672>internal-network</span>:
    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span> <span style=color:#75715e># default, can be omitted</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=related-posts>Related Posts</h2>
<ul>
<li>Creating service accounts with MongoDB in Docker</li>
<li>Change streams and replica sets with MongoDB in Docker</li>
<li>Docker: prepare for rendezvous</li>
<li>Creating a reverse proxy using docker-compose</li>
</ul>
</article>
</div>
</div>
</main>
<script src=/js/header.0b11855b871cb4d10c6c07b6723b9209f5c2bc9100735ab6ff47c8f9b76bb3d6ae41b488083b5fb15697987334039eb651b25c83228c29ac48a2bc168db8a894.js integrity="sha512-CxGFW4cctNEMbAe2cjuSCfXCvJEAc1q2/0fI+bdrs9auQbSICDtfsVaXmHM0A562UbJcgyKMKaxIorwWjbiolA=="></script>
<script src=/js/zooming.10cfe42f65295a0596af3315b671956309ed1d20e299e476ca16f6f6b902421e29c6f81a8f9a7ce816f84bef0791dbad2e61e68ff8fe798bd9ce9e093756d084.js integrity="sha512-EM/kL2UpWgWWrzMVtnGVYwntHSDimeR2yhb29rkCQh4pxvgaj5p86Bb4S+8HkdutLmHmj/j+eYvZzp4JN1bQhA=="></script>
<script src=/js/code-copy-btn.78c2b9fa7e7343f48dedd4c678f6aa49b144aa7b7e28e43d5bf5d8604134f4b2353ca3be02e66b7ace7d6ddd780de243dd71f9073446df964728e38c386e484f.js integrity="sha512-eMK5+n5zQ/SN7dTGePaqSbFEqnt+KOQ9W/XYYEE09LI1PKO+AuZres59bd14DeJD3XH5BzRG35ZHKOOMOG5ITw=="></script>
</body>
</html>